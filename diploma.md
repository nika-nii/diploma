[comment]: # (Одна оформленная страница составляет 25-30 строк по ~80 символов)

# Введение

В настоящее время быстрыми темпами развиваются системы, основанные на идеях 
интернета вещей (IoT, Internet of Things), предназначенные для автоматизации 
различных сфер жизни человека. Автоматизация широко распространяется на 
производственных предприятиях, в инфраструктуре города (умный город) и в быту. 
Потребность в технологиях домашней автоматизации, или системах "Умный дом" 
(Smart Home), создает новый и динамически растущий рынок устройств и 
программно-аппаратного обеспечения для умных домов.

Маркетинговые исследования говорят о том, что потребители заинтересованы в 
продукции, связанной с умным домом, и рынок ожидает устойчивый рост. 
Исследователи называют системы умного дома и умного города ключевой 
составляющей развития конкуренции в цифровой экономике. 

[comment]: # (Китаев, Миронова, ссылка)

В новых перспективах заинтересованы как крупные компании, желающие 
диверсифицировать активы, так и новые игроки, стремящиеся войти на формирующийся 
рынок.

Целью большинства крупных производителей является создание экосистемы, 
предоставляющей пользователю удобство использования продуктов, принадлежащих к 
одной линейке устройств. Такой подход привносит преимущества в виде удобства 
установки и настройки системы, простоты использования и поддержки со стороны 
производителя. Но ориентированные на существование в экосистеме устройства 
имеют определенные недостатки: "привязанность" к одному производителю неудобна 
для пользователя, стремящегося к построению сложной системой, включающей в себя 
различные типы датчиков и актуаторов. Ассортимент каждого из производителей в 
отдельности не удовлетворяет требованиям к системе в целом. Сочетание решений 
из различных линеек устройств или от различных производителей сильно затруднено 
из-за различий стандартов связи, питания, прикладных протоколов, и т. д.

Среди других недостатков существующих систем можно назвать связанные с 
использованием для функционирования сети устройств облачных решений, 
предоставляемых поставщиком оборудования, потенциальные проблемы с 
безопасностью и конфиденциальностью, а также зависимость от внешних факторов: 
наличия надежного подключения к сети Интернет и постоянной доступности сервиса.

Унификация решений умного дома затруднена тем, что не существует единого 
стандарта де-факто на построение систем автоматизации. По мере распространения 
систем возникает потребность в создании единых протоколов связи для 
взаимодействия устройств. В настоящее время существует некоторое количество 
распространенных протоколов проводной и беспроводной связи: 1-Wire, KNX, 
ZigBee, Bluetooth, однако сложно назвать какой-либо из них доминирующим на 
рынке.

Можно сделать вывод, что на рынке систем умного дома существует незанятая ниша 
для устройств, соответствующих какому-либо единому открытому стандарту, 
позволяющему легко расширять систему за счет устройств любого производителя, 
следующего спецификациям. Такая система не должна зависеть от единственного 
поставщика услуг и предоставлять пользователю возможность контролировать 
сервис, обеспечивающий связь и правильное функционирование устройств.

Задачей данной работы является проектирование комплекса устройств и протокола 
связи, формирующих систему умного дома, которая удовлетворяет требованиям к 
открытости, расширяемости и независимости от внешних сервисов.

Первая глава данной работы посвящена анализу существующих решений на рынке 
систем домашней автоматизации. Выявляются преимущества и недостатки имеющихся 
комплексов и предлагаются способы решения этих проблем. Также в данной главе 
осуществляется обзор существующих протоколов связи и выбор инструментов для 
решения поставленных задач.

Вторая глава предназначена для описания процесса проектирования схемотехники 
и печатных плат устройств и обоснования выбора компонентов в их составе.

Третья глава посвящена процессу проектирования и спецификации прикладных 
протоколов сети умного дома, структур данных и алгоритмов работы актуаторов и 
сенсоров.

Глава 4 описывает процесс реализации программного обеспечения, спецификации 
подпрограмм; содежит описание используемых сторонних библиотек и зависимостей, 
руководство пользователя и процесс тестирования готового ПАК.

# Основная часть

## Описание предметной области, обзор аналогов

### Актуальность проблемы

Интернет вещей - это новая тема, имеющая важное техническое, социальное и 
экономическое значение. Потребительские товары, товары длительного пользования, 
автомобили и грузовики, промышленные и энергетические компоненты, датчики и 
другие предметы повседневной жизни проектируются с подключением к Интернету и с 
мощными функциями анализа данных, что обещает полностью изменить наш стиль 
работы, образ жизни и развлечения.

Система умного дома строится с целью повысить уровень комфорта, обеспечить 
безопасность жилища от вторжений извне; позволяет контролировать инженерные 
системы здания с целью защиты от аварийных ситуаций и эффективного 
использования энергетических ресурсов.

Распространению технологии умного дома, согласно исследованиям маркетологов, 
препятствуют: 

- высокая цена устройств; 
- отсутствие в продаже модулей с интересующими функциями; 
- проблемы с установкой и использованием; 
- “сырость” технологий. 

Решив данные проблемы, можно создать устройства умного дома, которые найдут 
применение в новых системах, удовлетворяющих требованиям пользователей.

### Постановка задачи

Цель работы - создать систему, включающую в себя устройства для построения 
умного дома и протокол для связи устройств в сети. Система должна включать 
датчики и актуаторы для управления инфраструктурой и безопасностью здания.

Для достижения данной цели требуется выполнить следующие задачи:

- Проанализировать имеющиеся решения в сфере домашней автоматизации; определить 
их недостатки и преимущества 
- Проанализировать существующие стандарты связи в сфере автоматизации; выбрать 
подходящий низкоуровневый протокол связи устройств
- Описать прикладной протокол, использующийся для передачи информации внутри 
системы
- Разработать алгоритмы работы сенсоров и актуаторов, входящих в систему
- Спроектировать аппаратную составляющую устройств, принципиальную схему и 
печатную плату
- Разработать программное обеспечение, включающее реализацию протокола связи
- Отладить и протестировать разработанное решение

### Анализ существующих решений

Проведем анализ распространенных на рынке средств домашней автоматизации по 
следующим критериям: вид подключения: проводное или беспроводное; используемые 
протоколы связи: прикладной - соответствующий 7 уровню модели OSI, и 
используемый в качестве транспорта нижележащий протокол; организация питания 
устройств; сервис, обеспечивающий функционирование сети - удаленный или 
находящийся внутри локальной сети.

Строим таблицу: стандарт связи, прикладной протокол, тип связи, тип питания, 
возможно, ассортимент устройств, стоимость, кто управляет ?

Большинство рассматриваемых семейств решений домашней автоматизации нацелены на 
использование беспроводных технологий связи. Можно выделить такие преимущества 
данного подхода, как:

- простота внедрения системы в существующую инфраструктуру, отсутствие 
необходимости проводить работы по прокладке линий связи и питания
- возможность быстрого изменения конфигурации системы: легкое добавление и 
удаление новых устройств, а также перемещение в пределах досягаемости 
беспроводной сети

Недостатки такого подхода:

- поддержка беспроводных стандартов связи диктует усложнение конструкции 
устройств, и, как следствие, более высокую стоимость, по сравнению с проводными 
решениями
- наличие большого количества одновременно вещающих беспроводных устройств 
приводит к деградации сети из-за большого количества возникающих помех. 
Ситуация усугубляется тем, что большинство распространенных стандартов 
радиосвязи используют частоты 2.4 ГГц, разрешенные для свободного применения. 
Это означает, что беспроводные сети всегда подвержены внешним помехам со 
стороны других работающих сетей.

Для проводного подключения преимуществами являются:

- Надежность связи; при правильном проектировании и эксплуатации сети 
вероятность возникновения обрывов связи или помех сведена к минимуму
- Более простые по сравнению с беспроводными устройствами схемотехнические 
решения для канала связи, что положительно влияет на стоимость
- Возможность включения в инфраструктуру линий питания совместно с линиями 
передачи данных

Недостатками проводных сетей, соответственно, являются необходимость 
проектирования и построения инфраструктуры и сложность ее изменения.

Использование беспроводной связи для подключения устройств предполагает также 
питание от аккумуляторов или батарей для полной реализации возможностей 
беспроводного подключения. Современные микроконтроллеры с малым потреблением 
энергии, применяемые в таких устройствах, позволяют им работать без замены или 
перезарядки элементов питания долгое время. Но использование такого источника 
питания ограничивает мощность остальных компонентов; что ограничивает 
применение портативных источников питания. Для использования актуаторов, 
потребляющих большую, чем может обеспечить элемент питания, мощность, таких, 
как реле, двигатели и т.д., требуется обеспечить питание от бытовой сети или 
шины питания. При этом преимущества, предоставляемые беспроводным подключением, 
становятся бесполезными из-за необходимости прокладки дополнительных проводов;
а интеграция блока питания в устройство поднимает его стоимость.

- актуаторы, использующие питание от аккумуляторов или батарей, ограничены в 
используемой мощности

Использование предоставляемого производителем сервиса для управления системой 
также имеет свои преимущества и недостатки. Такой сервис позволяет 
пользователю в краткие сроки получить рабочую систему без специальных знаний;
используя минимальную конфигурацию. Благодаря применению облачных технологий 
сервис позволяет пользователю использовать систему с помощью Интернет из любого 
места без дополнительной настройки домашней сети. Но использование внешних 
сервисов создает зависимость нормального функционирования умного дома от 
неконтролируемых факторов, таких, как отсутствие подключения домашней сети к 
Интернет или сбои в сервисе провайдера. В пример можно привести сообщения 
пользователей о сбое в функционировании умных замков вследствие аварии на 
стороне провайдера, из-за чего двери оказывались заблокированы. Использование 
сервера умного дома внутри сети накладывает дополнительную сложность в 
конфигурации системы и создает еще одну зону отвественности для пользователя, 
но при этом исключает возможность возникновения подобной ситуации и уменьшает 
зависимость от внешних факторов.

Кроме стабильности функционирования системы, следует рассматривать вопрос 
безопасности и конфиденциальности. Согласно исследованиям, большая часть 
IoT-систем подвержена различным атакам из-за применения слабых схем шифрования, 
ошибок конфигурации и т.д. Учитывая, что сеть умного дома напрямую связана с 
устройствами, обеспечивающими безопасность пользователя и доступ к 
конфиденциальным данным, проблема защиты сети от вмешательства извне должна 
быть решена. Расположение сервера внутри сети позволяет создать закрытый контур, 
изолированный от сети Интернет полностью или частично, что позволяет обезопасить 
систему от утечек информации и перехвата управления. 

### Анализ стандартов связи

!!! Вставить сюда большую таблицу из статьи

Для проектируемой системы решено использовать проводной стандарт связи. Это 
позволяет снизить стоимость конечных устройств благодаря использованию более 
простой схемотехники и легкодоступных аппаратных компонентов. При подготовке 
инфраструктуры для развертывания системы возможна организация шины питания 
совместно с шиной передачи данных, благодаря чему станет возможным упростить 
цепи питания устройств, подключенных к шине, еще сильнее снижая их стоимость.

Системы проводной связи, поддерживающие топологию подключения "общая шина", 
являются более предпочтительным выбором, так как сложность построения 
инфраструктуры для подключения большого количества устройств по топологии 
"звезда" существенно выше, чем при использовании шины.

В результате сравнения приведенных в таблице стандартов проводных технологий 
связи было решено использовать стандарт CAN. Выбор обусловлен доступностью 
предназначенных для работы с CAN контроллеров, использование в качестве 
физического канала витой пары, высокой надежностью и поддержкой различных 
конфигураций.

Протокол CAN поддерживает построение сетей, поддерживающих быструю передачу 
данных (до 1 мбит/с) или функционирующих на больших расстояниях (до 5 км). В 
рамках построения сети умного дома длина шины имеет меньшее значение, чем 
скорость передачи данных, но это свойство CAN позволяет при необходимости 
организовать сеть на большом расстоянии, не изменяя аппаратную составляющую 
устройств, и требует при этом только конфигурации программного обеспечения для 
работы с сетью.

Основными преимуществами CAN перед другими протоколами является надежность 
передачи данных. Это обеспечивается предусмотренным стандартом контролем ошибок, 
включающим в себя контроль передачи, дополняющие биты, использование контрольной 
суммы и проверку полей при приеме.

Шина CAN определяет алгоритм арбитража доступа, основанный на подавлении 
рецессивных сигналов доминантными. Алгоритм осуществляет арбитраж без потери 
пропускной способности сети.


Проектирование аппаратной части

Привести в пример несколько вариантов организации шины данных, указать какие-то проекты.
Добавить табличное сравнение вариаций линий данных.
OneWire, Ethernet, Ethernet10, CAN, RS485.
Скорость, дальность, количество проводников, дополнительные возможности, топология.


!!!!!!!!!! Когда тут будет хотя бы строка 700 тогда и закончим !!!!!!!!!!!!

Предлагаемые крупными производителями комплексные решения, включаю в себя 
набор устройств и сервис для обеспечения работы системы, 
Стоит упомянуть проекты, предлагаемые энтузиастами. Чаще всего это системы, построенные на базе популярного электронного конструктора Arduino. Такие системы, как правило, не отвечают требованиям надежности и компактности. Кроме того, большинство подобных проектов использует плохо подходящие для решения поставленных задач технологии; к примеру, используется энергозатратный протокол Wi-Fi для связи устройств с высокими требованиями к экономичности потребления, или устаревший протокол RS-232 для проводной связи. [4] 

Основная часть. Исходя из названных недостатков, можно сформулировать ряд требований к системе умного дома, способной завоевать внимание покупателей. Такая система должна быть дешевой, не требовать дорогих систем коммуникации, легко расширяемой большим ассортиментом устройств. Обеспечить большой ассортимент решений можно при условии использования открытых протоколов и спецификаций сети. Такой подход позволит большему числу производителей выводить на рынок совместимые устройства, что в итоге приведет к росту популярности предлагаемых решений. Таким образом, одной из стратегий выхода на рынок умного дома может стать разработка открытого и надежного протокола взаимодействия устройств. 

В большинстве реализаций систем домашней автоматизации используется централизованная “клиент-серверная” архитектура, которая имеет существенный недостаток – наличие центрального узла системы (сервера), отвечающего за функционирование всей сети. Любой обмен информацией между отдельными устройствами происходит с участием сервера. При его неисправности, работа системы полностью парализуется. В некоторых случаях производители предусматривают такой сценарий, и устройства продолжают выполнять свои функции, но уже без использования сетевого взаимодействия с другими элементами системы. Для того чтобы исправить этот недостаток, предлагается при построении систем домашней автоматизации использовать распределенные сети. В этом случае все узлы в системе равноправны, и неисправность одного узла не влияет на работоспособность других.  

Конфигурация устройств с использованием клиент-серверной архитектуры не представляет сложности, поскольку точка, управляющая поведением системы, одна - сервер умного дома. При использовании же распределенных сетей каждое устройство несет в себе сценарии поведения, которые необходимо конфигурировать, в том числе и в ходе использования системы. Для разрешения проблемы авторы предлагают ввести в систему устройство администрирования, исполняющее исключительно роль интерфейса для конфигурации устройств. Отключение и подключение административного интерфейса не будет влиять на функционирование сети. 

При проектировании сетей, предназначенных для взаимодействия “умных” вещей, встают технические проблемы, связанные с параметрами сети и входящих в нее устройств. Среди основных параметров можно назвать: 

    стоимость сети, в т. ч. стоимость устройства; 

    экономичность потребления энергии (особенно актуально для беспроводных сетей); 

    гибкость настройки; 

    масштабируемость сети; 

    дальность связи. 

Улучшение одного из параметров неизбежно ведет к ухудшению других. Представленные на сегодняшний день протоколы, предназначенные для построения таких сетей, предлагают разумный компромисс между обозначенными параметрами. Однако, авторы полагают, что более удовлетворяющим всем запросам современного пользователя решением могут стать гетерогенные сети. 

В частности, предлагается использовать двухуровневую сеть: верхний уровень обеспечивается широко распространенным стеком протоколов TCP/IP через среду Ethernet или Wi-Fi, а нижний уровень выбирается исходя из требований конкретного применения. Для проводных коммуникаций предлагается использовать стандарт CAN и физический уровень в виде дифференциальной пары. А для построения беспроводных сетей использование стандарта Bluetooth, в частности технологию с низким потреблением Bluetooth Low Energy. 

Выбор данных технологий мотивирован следующими соображениями. Открытый стек протоколов TCP/IP поверх Ethernet или Wi-Fi является самым распространенным сетевым решением на сегодняшний день. Большинство домохозяйств уже имеет сеть, построенную на данном стеке, и сети, построенные на этих технологиях, имеют большой потенциал для масштабирования. Использование же Ethernet и Wi-Fi для связи узлов в малой локальной сети (между отдельными датчиками и исполнительными устройствами в помещении) нецелесообразно в связи с высокой стоимостью контроллеров физического уровня и большим потреблением энергии. 

Дешевый и надежный проводной канал связи можно построить с помощью CAN. Шина CAN - широко распространенный индустриальный стандарт, используемый в промышленной и домашней автоматизации, а также автомобильной промышленности. Коммуникации с ее помощью предоставляют высокую степень надежности и более чем достаточную для систем автоматизации производительность сети. Спецификация CAN на физическом уровне определяет одноранговую сеть, что поддерживает концепцию построения распределенной системы домашней автоматизации. [5] 

Анализ существующих решений
Необходимо выбрать какие-либо варианты решений.
Смотрим на Apple Home, Xiaomi, Ростелеком, Ujin, что-нибудь еще?

